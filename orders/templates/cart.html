{% extends "base_generic.html" %}

{% block tittle %}
Shopping cart
{% endblock %}

{% block main %}
<h1>Your cart</h1>
<br>
{% if item_list %}
    <table class="table">
        <thead>
            <tr>
                <th scope="col">Item</th>
                <th scope="col">Notes</th>
                <th scope="col">Size</th>
                <th scope="col">Quantity</th>
                <th scope="col">Price</th>
            </tr>
        </thead>
        <tbody>
            {% for item in item_list %}
            <tr>
                <td>{{ item.item }}</td>
                {% if item.display_topping %}
                    <td>{{ item.display_topping }}</td>
                {% elif item.display_subx %}
                    <td>{{ item.display_subx}}</td>
                {% else %}
                    <td>N/A</td>
                {% endif %}
                <td>{{ item.size }}</td>
                <td>{{ item.quantity }}</td>
                <td><span class="item-price">{{ item.price }}</span></td>
            </tr>
            {% endfor %}

        </tbody>
    </table>

<div class="text-right">
    <h3>
        Total: $ <span id="total-price"></span>
    </h3>
</div>

<br>
<div class="text-center p-2 bd-highlight">
    <form id="submit_order" action="{% url 'new_order' %}" method="post">
        {% csrf_token %}
        <input name="order_id" value="{{ order_id }}" style="display: none">
        <!-- <input id="timestamp" name="timestamp" value="" style="display: none"> -->
        <button class="btn btn-primary" type="submit">Place an order</button>
    </form>
    <a href="{% url 'menu' %}">
        <p style="font-size: 0.75em;">Continue shopping</p>
    </a>   
</div>

{% else %}
    <p>Empty cart.</p>

    <div class="text-center p-2 bd-highlight">
        <a href="{% url 'menu' %}">
            <p style="font-size: 0.75em;">Continue shopping</p>
        </a>   
    </div>
{% endif %}

<script>
    var total_price = 0;
    document.querySelectorAll('.item-price').forEach(price => {
        total_price += parseFloat(price.innerHTML);
    })

    document.querySelector('#total-price').innerHTML = total_price.toFixed(2);
    
    // document.querySelector('#submit_order').onsubmit = () => {
    //     const timestamp = new Date().getFullYear() +"-"
    //         + new Date().getMonth() +"-"
    //         + new Date().getDate() +" "
    //         + new Date().getHours() + ":" 
    //         + new Date().getMinutes();
    //     const input = document.querySelector('#timestamp');
    //     input.setAttribute('value', timestamp);
    // }
</script>
{% endblock %}